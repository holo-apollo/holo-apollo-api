{"version":3,"file":"js/signup-bundle.js","sources":["webpack:///src/signup.js","webpack:///src/apps/users/containers/signup.js","webpack:///./src/styles/login_signup.less?84ed","webpack:///./src/styles/login_signup.less"],"sourcesContent":["import React from 'react';\nimport ReactDOM from 'react-dom';\n\nimport './axios_defaults';\nimport Signup from 'apps/users/containers/signup';\n\n\nReactDOM.render(<Signup/>, document.getElementById('react-signup'));\n\n\n\n// WEBPACK FOOTER //\n// src/signup.js","import 'styles/login_signup.less';\nimport React, {Component} from 'react';\nimport {Form, Text} from 'react-form';\nimport autoBind from 'react-autobind';\nimport cx from 'classnames';\n\nimport {Button} from 'common/components/buttons';\nimport {DoubleBounceSpinner} from 'common/components/spinners';\nimport {validateEmail, validatePhone, validateLength} from 'helpers/validators';\nimport {get, post} from 'helpers/rest';\n\n\nexport default class Signup extends Component {\n    constructor(props) {\n        super(props);\n        autoBind(this);\n        this.state = {\n            submitPending: false,\n            submitErrors: {\n                email: null,\n                password: null,\n                first_name: null,\n                last_name: null,\n                username: null,\n                phone: null\n            },\n            signupStep: 1,\n            formValues: {}\n        };\n    }\n\n    goNext() {\n        this.setState({\n            signupStep: 2\n        });\n    }\n\n    goBack() {\n        this.setState({\n            signupStep: 1\n        });\n    }\n\n    validateError1(values) {\n        this.setState({submitErrors: {\n            email: null,\n            password: null,\n            first_name: null,\n            last_name: null,\n            username: null,\n            phone: null\n        }});\n        const errors = {\n            email: null,\n            password: null\n        };\n        if (!values.email) {\n            errors.email = gettext('Please type your email.');\n        } else if (!validateEmail(values.email)) {\n            errors.email = gettext('Oops... There\\'s a mistake. Please type a valid email.');\n        }\n        // TODO: add strong password validation\n        if (!values.password || !values.password2) {\n            errors.password = gettext('Please type your password twice.');\n        } else if (values.password !== values.password2) {\n            errors.password = gettext('Oops... Passwords didn\\'t match');\n        }\n        return errors;\n    }\n\n    validateError2(values) {\n        this.setState({submitErrors: {\n            email: null,\n            password: null,\n            first_name: null,\n            last_name: null,\n            username: null,\n            phone: null\n        }});\n        const errors = {\n            first_name: null,\n            last_name: null,\n            username: null,\n            phone: null\n        };\n        if (!validateLength(values.first_name, 30, 2)) {\n            errors.first_name = gettext('Please type your first name 2-30 characters long.');\n        }\n        if (!validateLength(values.last_name, 30)) {\n            errors.first_name = gettext('Max length of last name is 30 characters.');\n        }\n        if (!validateLength(values.username, 30, 2)) {\n            errors.username = gettext('Please type your name on the site 2-30 characters long.');\n        }\n        if (!validatePhone(values.phone)) {\n            errors.phone = gettext('Please type a valid phone number.');\n        }\n        return errors;\n    }\n\n    onSubmit1(values) {\n        this.setState({\n            submitPending: true\n        });\n        get(`users/check_email/?email=${values.email}`)\n            .then(response => {\n                this.setState({\n                    submitPending: false\n                });\n                const emailExists = response.data.email_exists;\n                if (emailExists) {\n                    this.setState({\n                        submitErrors: {\n                            ...this.state.submitErrors,\n                            email: gettext('That email already exists')\n                        }\n                    });\n                } else {\n                    this.setState({\n                        formValues: {\n                            email: values.email,\n                            password: values.password\n                        }\n                    });\n                    this.goNext();\n                }\n            })\n            .catch(() => {\n                this.setState({\n                    submitErrors: {\n                        ...this.state.submitErrors,\n                        email: gettext('\\'Oops! Something went wrong. Please try again in a moment.')\n                    }\n                });\n            });\n    }\n\n    onSubmit2(values) {\n        this.setState({\n            submitPending: true\n        });\n        values = {...this.state.formValues, ...values};\n        post('users/', values)\n            .then(() => {\n                window.location = '/';  // TODO: change it to profile page\n            }).catch(error => {\n                let messages = {\n                    common: gettext('Oops! Something went wrong. Please try again in a moment.')\n                };\n                if (error.response && error.response.data && typeof error.response.data === 'object') {\n                    messages = error.response.data;\n                }\n                this.setState({\n                    submitPending: false,\n                    submitErrors: messages\n                });\n            });\n    }\n\n    renderTextInput(error, fieldName, placeholder) {\n        return [\n            <div className={'error'} key={`error-${fieldName}`}>\n                {error ? error : this.state.submitErrors[fieldName]}\n            </div>,\n            <Text\n                key={`field-${fieldName}`}\n                field={fieldName}\n                name={fieldName}\n                className={'grow'}\n                placeholder={placeholder}\n            />\n        ];\n    }\n\n    renderForm1() {\n        return (\n            <div className={cx('signup-form', {'hidden': this.state.submitPending || this.state.signupStep !== 1})}>\n                <Form\n                    onSubmit={this.onSubmit1}\n                    validateError={this.validateError1}\n                    dontValidateOnMount={true}\n                    validateOnSubmit={true}\n                >\n                    {formApi => {\n                        return (\n                            <form onSubmit={formApi.submitForm}>\n                                <div className={'inputs'}>\n                                    {this.renderTextInput(formApi.errors.email, 'email', gettext('Email'))}\n                                    <div className={'error'}>\n                                        {formApi.errors.password}\n                                    </div>\n                                    <Text\n                                        field=\"password\"\n                                        type={'password'}\n                                        name={'password'}\n                                        className={'grow'}\n                                        placeholder={gettext('Make up password')}\n                                    />\n                                    <Text\n                                        field=\"password2\"\n                                        type={'password'}\n                                        name={'password2'}\n                                        className={'grow'}\n                                        placeholder={gettext('Retype password')}\n                                    />\n                                    <Button type={'submit'}>\n                                        {gettext('Create account')}\n                                    </Button>\n                                </div>\n                            </form>\n                        );\n                    }}\n                </Form>\n            </div>\n        );\n    }\n\n    renderForm2() {\n        return (\n            <div className={cx('signup-form', {'hidden': this.state.submitPending || this.state.signupStep !== 2})}>\n                <div onClick={this.goBack}>Go back</div>\n                <Form\n                    onSubmit={this.onSubmit2}\n                    validateError={this.validateError2}\n                    dontValidateOnMount={true}\n                    validateOnSubmit={true}\n                >\n                    {formApi => {\n                        const fields = {\n                            first_name: gettext('Your first name *'),\n                            last_name: gettext('Your last name'),\n                            username: gettext('Name on the site *'),\n                            phone: gettext('Phone *')\n                        };\n                        return (\n                            <form onSubmit={formApi.submitForm}>\n                                <div className={'inputs'}>\n                                    {Object.keys(fields).map(item => {\n                                        return this.renderTextInput(formApi.errors[item], item, fields[item]);\n                                    })}\n                                    <Button type={'submit'}>{gettext('Save')}</Button>\n                                </div>\n\n                                <div className={'error'}>{this.state.submitErrors.email}</div>\n                                <div className={'error'}>{this.state.submitErrors.common}</div>\n                            </form>\n                        );\n                    }}\n                </Form>\n            </div>\n        );\n    }\n\n    render() {\n        console.log('Test');\n        return (\n            <div className={'login-signup'}>\n                <h1>Sign up</h1>\n                <div>Already a member? <a href=\"/login/\">Log in</a></div>\n                {this.state.submitPending && <DoubleBounceSpinner/>}\n                {this.renderForm1()}\n                {this.renderForm2()}\n            </div>\n        );\n    }\n}\n\n\n\n// WEBPACK FOOTER //\n// src/apps/users/containers/signup.js","\nvar content = require(\"!!../../node_modules/css-loader/index.js!../../node_modules/less-loader/dist/cjs.js!./login_signup.less\");\n\nif(typeof content === 'string') content = [[module.id, content, '']];\n\nvar transform;\nvar insertInto;\n\n\n\nvar options = {\"hmr\":true}\n\noptions.transform = transform\noptions.insertInto = undefined;\n\nvar update = require(\"!../../node_modules/style-loader/lib/addStyles.js\")(content, options);\n\nif(content.locals) module.exports = content.locals;\n\nif(module.hot) {\n\tmodule.hot.accept(\"!!../../node_modules/css-loader/index.js!../../node_modules/less-loader/dist/cjs.js!./login_signup.less\", function() {\n\t\tvar newContent = require(\"!!../../node_modules/css-loader/index.js!../../node_modules/less-loader/dist/cjs.js!./login_signup.less\");\n\n\t\tif(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n\n\t\tvar locals = (function(a, b) {\n\t\t\tvar key, idx = 0;\n\n\t\t\tfor(key in a) {\n\t\t\t\tif(!b || a[key] !== b[key]) return false;\n\t\t\t\tidx++;\n\t\t\t}\n\n\t\t\tfor(key in b) idx--;\n\n\t\t\treturn idx === 0;\n\t\t}(content.locals, newContent.locals));\n\n\t\tif(!locals) throw new Error('Aborting CSS HMR due to changed css-modules locals.');\n\n\t\tupdate(newContent);\n\t});\n\n\tmodule.hot.dispose(function() { update(); });\n}\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/styles/login_signup.less\n// module id = 64\n// module chunks = 1 2","exports = module.exports = require(\"../../node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \".login-signup .inputs {\\n  display: flex;\\n  flex-direction: column;\\n}\\n.login-signup .inputs input {\\n  margin-bottom: 10px;\\n}\\n.login-signup .inputs button {\\n  width: 100%;\\n}\\n.login-signup .error {\\n  margin-top: 17px;\\n  color: #f57575;\\n}\\n\", \"\"]);\n\n// exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/css-loader!./node_modules/less-loader/dist/cjs.js!./src/styles/login_signup.less\n// module id = 65\n// module chunks = 1 2"],"mappings":";;;;;;;;AAAA;AACA;;;AAAA;AACA;;;AACA;AACA;AAAA;AACA;;;;;AAEA;;;;;;;;;;;;;;;;;;;;ACPA;AACA;AAAA;AACA;;;AAAA;AACA;AAAA;AACA;;;AAAA;AACA;;;AACA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AACA;;;;;;;;;AAEA;;;AACA;AAAA;AACA;AADA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AANA;AAQA;AACA;AAXA;AAHA;AAgBA;AACA;;;AACA;AACA;AACA;AADA;AAGA;;;AAEA;AACA;AACA;AADA;AAGA;;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AANA;AAQA;AACA;AACA;AAFA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AANA;AAQA;AACA;AACA;AACA;AACA;AAJA;AAMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAEA;AAAA;AACA;AAAA;AACA;AADA;AAGA;AAEA;AACA;AADA;AAGA;AACA;AACA;AACA;AAEA;AAFA;AADA;AAMA;AACA;AACA;AACA;AACA;AAFA;AADA;AAMA;AACA;AACA;AAEA;AACA;AAEA;AAFA;AADA;AAMA;AACA;;;AAEA;AAAA;AACA;AAAA;AACA;AADA;AAGA;AACA;AAEA;AACA;AACA;AACA;AADA;AAGA;AACA;AACA;AACA;AACA;AACA;AAFA;AAIA;AACA;;;AAEA;AACA;AACA;AAAA;AACA;AADA;AAIA;AACA;AACA;AACA;AACA;AALA;AAQA;;;AAEA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAJA;AAMA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AACA;AACA;AAAA;AAAA;AACA;AADA;AAGA;AACA;AACA;AACA;AACA;AACA;AALA;AAOA;AACA;AACA;AACA;AACA;AACA;AALA;AAOA;AAAA;AAAA;AACA;AADA;AAnBA;AADA;AA0BA;AAlCA;AADA;AAuCA;;;AAEA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAJA;AAMA;AACA;AACA;AACA;AACA;AACA;AAJA;AAMA;AACA;AAAA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAJA;AAOA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AATA;AAYA;AA1BA;AAFA;AAgCA;;;AAEA;AACA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AALA;AAQA;;;;;;AA5PA;;;;;;;ACZA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;AC5CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;A","sourceRoot":""}